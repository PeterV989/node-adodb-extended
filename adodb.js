/**
 * @module node-adodb
 * @author nuintun
 * @license MIT
 * @version 5.0.5
 * @description A Node.js JavaScript Client implementing the ADODB protocol.
 * @see https://github.com/nuintun/node-adodb#readme
 */
!function () { "use strict"; function t(t) { t.State && t.Close() } function e(t) { WScript.StdOut.Write(JSON.stringify(t)) } function n(t) { var e, n = t.number, r = t.description; r || (r = "Unspecified error, SQL may contain reserved words and symbols, surround it with brackets []"), e = { code: n, message: r }, WScript.StdErr.Write(JSON.stringify(e)) } function r(t) { return 7 === t || 64 === t || 133 === t || 134 === t || 135 === t } function o(t) { return 128 === t || 204 === t || 205 === t } function u(e) { var n = new ActiveXObject("ADODB.Stream"); n.Type = 1, n.Open(), n.Position = 0, n.Write(e), n.Position = 0, n.Type = 2; var r = n.ReadText(); return t(n), r } function c(t) { var e = { type: !1, ResultSet: [] }, n = t.Fields; if (!t.BOF || !t.EOF) { var i, c, a, f, s, p = n.Count; for (t.MoveFirst(); !t.EOF;) { for (c = {}, i = 0; i < p; i++)f = (a = n.Item(i)).Type, s = a.Value, r(f) ? s = new Date(s) : o(f) && (s = u(s)), c[a.Name] = s; e.ResultSet.push(c), t.MoveNext() } } return e } "object" != typeof JSON && (JSON = {}), function () { var t, e, n, r, o = /^[\],:{}\s]*$/, i = /\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, u = /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, c = /(?:^|:|,)(?:\s*\[)+/g, a = /[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, f = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g; function s(t) { return t < 10 ? "0" + t : t } function p() { return this.valueOf() } function l(t) { return a.lastIndex = 0, a.test(t) ? '"' + t.replace(a, (function (t) { var e = n[t]; return "string" == typeof e ? e : "\\u" + ("0000" + t.charCodeAt(0).toString(16)).slice(-4) })) + '"' : '"' + t + '"' } "function" != typeof Date.prototype.toJSON && (Date.prototype.toJSON = function () { return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + s(this.getUTCMonth() + 1) + "-" + s(this.getUTCDate()) + "T" + s(this.getUTCHours()) + ":" + s(this.getUTCMinutes()) + ":" + s(this.getUTCSeconds()) + "Z" : null }, Boolean.prototype.toJSON = p, Number.prototype.toJSON = p, String.prototype.toJSON = p), "function" != typeof JSON.stringify && (n = { "\b": "\\b", "\t": "\\t", "\n": "\\n", "\f": "\\f", "\r": "\\r", '"': '\\"', "\\": "\\\\" }, JSON.stringify = function (n, o, i) { var u; if (t = "", e = "", "number" == typeof i) for (u = 0; u < i; u += 1)e += " "; else "string" == typeof i && (e = i); if (r = o, o && "function" != typeof o && ("object" != typeof o || "number" != typeof o.length)) throw new Error("JSON.stringify"); return function c(n, o) { var i, u, a, f, s, p = t, O = o[n]; switch (O && "object" == typeof O && "function" == typeof O.toJSON && (O = O.toJSON(n)), "function" == typeof r && (O = r.call(o, n, O)), typeof O) { case "string": return l(O); case "number": return isFinite(O) ? String(O) : "null"; case "boolean": case "null": return String(O); case "object": if (!O) return "null"; if (t += e, s = [], "[object Array]" === Object.prototype.toString.apply(O)) { for (f = O.length, i = 0; i < f; i += 1)s[i] = c(i, O) || "null"; return a = 0 === s.length ? "[]" : t ? "[\n" + t + s.join(",\n" + t) + "\n" + p + "]" : "[" + s.join(",") + "]", t = p, a } if (r && "object" == typeof r) for (f = r.length, i = 0; i < f; i += 1)"string" == typeof r[i] && (a = c(u = r[i], O)) && s.push(l(u) + (t ? ": " : ":") + a); else for (u in O) Object.prototype.hasOwnProperty.call(O, u) && (a = c(u, O)) && s.push(l(u) + (t ? ": " : ":") + a); return a = 0 === s.length ? "{}" : t ? "{\n" + t + s.join(",\n" + t) + "\n" + p + "}" : "{" + s.join(",") + "}", t = p, a } }("", { "": n }) }), "function" != typeof JSON.parse && (JSON.parse = function (t, e) { var n; if (t = String(t), f.lastIndex = 0, f.test(t) && (t = t.replace(f, (function (t) { return "\\u" + ("0000" + t.charCodeAt(0).toString(16)).slice(-4) }))), o.test(t.replace(i, "@").replace(u, "]").replace(c, ""))) return n = new Function("return " + t)(), "function" == typeof e ? function r(t, n) { var o, i, u = t[n]; if (u && "object" == typeof u) for (o in u) Object.prototype.hasOwnProperty.call(u, o) && ((i = r(u, o)) !== undefined ? u[o] = i : delete u[o]); return e.call(t, n, u) }({ "": n }, "") : n; throw new SyntaxError("JSON.parse") }) }(); var a = { execute: function (r) { var o, i = [], u = !!r.scalar, a = new ActiveXObject("ADODB.Connection"); u && (o = new ActiveXObject("ADODB.Recordset")), a.CursorLocation = 3; try { a.Open(r.connection), a.Execute(r.sql), u && (o.Open(r.scalar, a, 0, 1), i = c(o)), e(i) } catch (f) { n(f) } t(a), u && t(o) }, transaction: function (r) { var o = new ActiveXObject("ADODB.Connection"); o.CursorLocation = 3; try { for (o.Open(r.connection), o.BeginTrans(), i = 0; i < r.sql.length; i++)o.Execute(r.sql[i]) } catch (u) { o.RollbackTrans(), n(u) } o.CommitTrans(), e([]), t(o) }, query: function (r) { var o = new ActiveXObject("ADODB.Connection"), i = new ActiveXObject("ADODB.Recordset"); o.CursorLocation = 3; try { o.Open(r.connection), i.Open(r.sql, o, 0, 1), e(c(i).ResultSet) } catch (u) { n(u) } t(i), t(o) }, query_v2: function (i) { var a = new ActiveXObject("ADODB.Connection"), f = new ActiveXObject("ADODB.Recordset"); a.CursorLocation = 3; try { a.Open(i.connection), f.Open(i.sql, a, 0, 1), i.FetchArrays ? e(function (t) { var e, n, i = t.Fields, c = i.Count, a = { type: !0, ResultSet: { FieldMetaData: { FieldNames: [], FieldTypes: [] }, ResultSet: [] } }; if (!t.BOF || !t.EOF) { for (t.MoveFirst(), e = 0; e < c; e++)a.ResultSet.FieldMetaData.FieldNames.push(i.Item(e).Name), a.ResultSet.FieldMetaData.FieldTypes.push(i.Item(e).Type); for (; !t.EOF;) { var f = []; for (e = 0; e < c; e++) { var s = i.Item(e), p = s.type; r(p) ? f.push(new Date(s.value)) : o(p) ? f.push(u(s.value)) : "string" == typeof s.value ? f.push("string" != typeof (n = s.value) ? n : n.replace(/^\s+|\s+$/g, "")) : f.push(s.value) } a.ResultSet.ResultSet.push(f), t.MoveNext() } } return a }(f)) : e(c(f)) } catch (s) { n(s) } t(f), t(a) }, schema: function (r) { var o, i = new ActiveXObject("ADODB.Connection"); i.CursorLocation = 3; try { i.Open(r.connection), e(c(o = r.hasOwnProperty("id") ? i.OpenSchema(r.type, r.criteria, r.id) : r.hasOwnProperty("criteria") ? i.OpenSchema(r.type, r.criteria) : i.OpenSchema(r.type))) } catch (u) { n(u) } t(o), t(i) } }, f = WScript.Arguments(0), s = JSON.parse(WScript.StdIn.ReadAll()); a[f](s) }();
